"use strict";Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const s=require("react"),le=e=>e&&typeof e=="object"&&"default"in e?e:{default:e},i=le(s);function re(e){return e.selectionStart===0&&e.selectionEnd===0}function ue(e){const t=e.value.length;return e.selectionStart===t&&e.selectionEnd===t}function w(e){return`${e}-label`}function ie(e){return`${e}-combobox`}function ce(e){return`${e}-input`}function q(e){return`${e}-listbox`}function H(e,t){return`${e}-option-${fe(t)}`}const de=/%value%/;function h(e,t){return e.replace(de,t)}const pe=/\s+/g;function L(e){return`${String(e.value)}-${e.label}`}function fe(e){return L(e).replace(pe,"_")}function C(e,t){return t.findIndex(({value:n})=>n===e.value)}const ve=/[-\\^$*+?.()|[\]{}]/g;function G(e){return e.replace(ve,"\\$&")}function J(e){return new RegExp(`${G(e)}`,"i")}function ge(e){return new RegExp(`^${G(e)}$`,"i")}function xe(e){const t=J(e);return n=>t.test(n)}function me(e){const t=ge(e);return n=>t.test(n)}function be(e,t){if(e==="")return[].concat(t);{const n=xe(e);return t.filter(a=>n(a.label))}}function ye(e,t){const n=me(e);return t.find(a=>n(a.label))||null}const p=i.default.createContext(void 0);function Ee(){const{comboBoxRef:e,id:t,manager:n}=s.useContext(p);return s.useMemo(()=>({id:ie(t),ref:e,onBlur(a){var o;(o=e.current)!=null&&o.contains(a.relatedTarget)||(n.collapse(),n.clearActiveIndex())},onFocus(a){var o;(o=e.current)!=null&&o.contains(a.relatedTarget)||n.expand()},onClick(){n.state.isExpanded||n.expand()}}),[e,t,n])}const b={Enter:"Enter",Escape:"Escape",Tab:"Tab",Backspace:"Backspace",UpArrow:"ArrowUp",UpArrowCompat:"Up",DownArrow:"ArrowDown",DownArrowCompat:"Down",PageDown:"PageDown",PageUp:"PageUp"},$=Symbol("Create new tag"),Q=Symbol("No options"),K=()=>{},Ie={autoComplete:"off",autoCorrect:"off","data-form-type":"other",spellCheck:!1};function Ce({allowBackspace:e,allowTab:t,ariaDescribedBy:n,ariaErrorMessage:a}){const{id:o,inputRef:c,isDisabled:r,isInvalid:d,manager:l,onInput:f,onSelect:v}=s.useContext(p),m=s.useMemo(()=>{const D=u=>{const E=u.currentTarget.value;l.updateValue(E),f==null||f(E)},S=u=>{l.state.isExpanded?(u.preventDefault(),l.updateActiveIndex(l.state.activeIndex+1)):ue(u.currentTarget)&&l.expand()},T=u=>{l.state.isExpanded?(u.preventDefault(),l.updateActiveIndex(l.state.activeIndex-1)):re(u.currentTarget)&&l.expand()},O=u=>{l.state.isExpanded&&(u.preventDefault(),l.updateActiveIndex(l.state.options.length-1))},A=u=>{l.state.isExpanded&&(u.preventDefault(),l.updateActiveIndex(0))},P=u=>{l.state.isExpanded&&(u.preventDefault(),v())},k=()=>{l.state.isExpanded?(l.clearActiveIndex(),l.collapse()):l.clearValue()},N=()=>{if(e){const u=l.state.value==="",E=l.state.selected[l.state.selected.length-1];u&&E&&v(E)}},_=u=>{t&&l.state.isExpanded&&(u.preventDefault(),v())};return{onChange:D,onKeyDown:u=>{if(u.key===b.UpArrow)return T(u);if(u.key===b.DownArrow)return S(u);if(u.key===b.PageUp)return A(u);if(u.key===b.PageDown)return O(u);if(u.key===b.Enter)return P(u);if(u.key===b.Escape)return k();if(u.key===b.Backspace)return N();if(u.key===b.Tab)return _(u)}}},[e,t,l,f,v]),{activeOption:y,isExpanded:x,value:R}=l.state;return{...Ie,"aria-autocomplete":"list","aria-activedescendant":y?H(o,y):void 0,"aria-describedby":n||void 0,"aria-disabled":r,"aria-errormessage":d&&a||void 0,"aria-invalid":d,"aria-labelledby":w(o),"aria-expanded":x,"aria-owns":q(o),id:ce(o),onChange:r?K:m.onChange,onKeyDown:r?K:m.onKeyDown,ref:c,role:"combobox",type:"text",value:R}}const he={position:"absolute",width:0,height:0,visibility:"hidden",overflow:"scroll",whiteSpace:"pre"},we=["font-family","font-size","font-style","font-weight","letter-spacing","text-transform"];function Re({allowResize:e=!0,text:t}){const n=s.useRef(null),{inputRef:a}=s.useContext(p),[o,c]=s.useState(0);return s.useEffect(()=>{if(a.current){const r=window.getComputedStyle(a.current);we.forEach(d=>{var f;const l=r.getPropertyValue(d);(f=n.current)==null||f.style.setProperty(d,l)})}},[a,n]),s.useEffect(()=>{var r,d;if(e){const l=Math.ceil((d=(r=n.current)==null?void 0:r.scrollWidth)!=null?d:0)+2;o!==l&&c(l)}},[e,t,o]),{width:o,sizerProps:{ref:n,style:he}}}function De(){var c;const{inputRef:e,manager:t,tagListRef:n}=s.useContext(p),a=t.flags.tagsDeleted.length,o=(c=n.current)==null?void 0:c.contains(document.activeElement);s.useEffect(()=>{var r,d;if(a){const l=(r=n.current)==null?void 0:r.contains(document.activeElement);o&&!l&&((d=e.current)==null||d.focus())}},[e,o,n,a])}function Se({newOptionText:e,noOptionsText:t,onValidate:n}){return s.useMemo(()=>({newTagOption(a){return{disabled:typeof n=="function"?!n(a):!1,label:e,value:$}},noTagsOption(){return{disabled:!0,label:t,value:Q}}}),[e,t,n])}function Te(){const{id:e,listBoxRef:t,manager:n}=s.useContext(p);return s.useEffect(()=>{var a;n.state.activeIndex===-1&&((a=t.current)==null||a.scrollTo({top:0}))},[t,n.state.activeIndex]),{"aria-labelledby":w(e),id:q(e),ref:t,role:"listbox"}}var g=(e=>(e[e.ClearActiveIndex=0]="ClearActiveIndex",e[e.ClearAll=1]="ClearAll",e[e.ClearValue=2]="ClearValue",e[e.Collapse=3]="Collapse",e[e.Expand=4]="Expand",e[e.UpdateActiveIndex=5]="UpdateActiveIndex",e[e.UpdateSelected=6]="UpdateSelected",e[e.UpdateSuggestions=7]="UpdateSuggestions",e[e.UpdateValue=8]="UpdateValue",e))(g||{});function Oe(e,t){const n=t-1;return e>n?-1:e<-1?n:e}function Ae(e,t){if(t.type===0)return{...e,activeIndex:-1,activeOption:null};if(t.type===1)return{...e,activeIndex:-1,activeOption:null,isExpanded:!1,options:[...e.suggestions],value:""};if(t.type===2){const n=[...e.suggestions],a=e.activeOption?C(e.activeOption,n):-1;return{...e,activeIndex:a,activeOption:n[a],options:n,value:""}}if(t.type===3)return{...e,activeIndex:-1,activeOption:null,isExpanded:!1};if(t.type===4)return{...e,isExpanded:!0};if(t.type===5){const n=Oe(t.payload,e.options.length);return{...e,activeIndex:n,activeOption:e.options[n]}}if(t.type===6)return{...e,selected:t.payload};if(t.type===7){const n=e.suggestionsTransform(e.value,t.payload);e.allowNew&&e.value&&n.push(e.newTagOption(e.value)),n.length===0&&e.value&&n.push(e.noTagsOption(e.value));const a=e.activeOption?C(e.activeOption,n):-1;return{...e,activeIndex:a,activeOption:n[a]||null,options:n,suggestions:t.payload}}if(t.type===8){const n=e.suggestionsTransform(t.payload,e.suggestions);e.allowNew&&t.payload&&n.push(e.newTagOption(t.payload)),n.length===0&&t.payload&&n.push(e.noTagsOption(t.payload));const a=e.activeOption?C(e.activeOption,n):-1;return{...e,activeIndex:a,activeOption:n[a]||null,isExpanded:!0,options:n,value:t.payload}}return e}function W(e,t){return e===t?[]:e.filter(n=>!t.includes(n))}function Pe(e){const t=e.suggestionsTransform(e.value,e.suggestions);return{...e,options:t}}function ke(e){const[t,n]=s.useReducer(Ae,e,Pe),a=s.useRef({state:null,flags:null,clearActiveIndex(){n({type:g.ClearActiveIndex})},clearAll(){n({type:g.ClearAll})},clearValue(){n({type:g.ClearValue})},collapse(){n({type:g.Collapse})},expand(){n({type:g.Expand})},updateActiveIndex(o){n({type:g.UpdateActiveIndex,payload:o})},updateSelected(o){n({type:g.UpdateSelected,payload:o})},updateSuggestions(o){n({type:g.UpdateSuggestions,payload:o})},updateValue(o){n({type:g.UpdateValue,payload:o})}});return a.current.flags={tagsAdded:a.current.state?W(t.selected,a.current.state.selected):[],tagsDeleted:a.current.state?W(a.current.state.selected,t.selected):[]},a.current.state=t,e.selected!==t.selected&&a.current.updateSelected(e.selected),e.suggestions!==t.suggestions&&a.current.updateSuggestions(e.suggestions),a.current}function Ne(e,t){if((e==null?void 0:e.value)===$&&e.disabled===!1)return{value:t,label:t}}function _e(e){const t=Ne(e.activeOption,e.value)||e.activeOption||ye(e.value,e.options);return t&&!t.disabled?t:void 0}function Be({closeOnSelect:e,manager:t,onAdd:n,onDelete:a}){return s.useCallback(o=>{if(o!=null||(o=_e(t.state)),!o)return;const c=C(o,t.state.selected);c>=0?a(c):(n(o),e?t.clearAll():t.clearValue())},[e,t,a,n])}function Ue(e){var y;const{id:t,inputRef:n,manager:a,onSelect:o}=s.useContext(p),c=s.useRef(null),r=a.state.options[e],d=e===a.state.activeIndex,l=(y=r.disabled)!=null?y:!1,f=C(r,a.state.selected)>-1,v=s.useCallback(()=>{var x;o(),(x=n.current)==null||x.focus()},[n,o]),m=s.useCallback(()=>{e!==a.state.activeIndex&&a.updateActiveIndex(e)},[e,a]);return s.useEffect(()=>{var x;d&&((x=c.current)==null||x.scrollIntoView({block:"nearest",inline:"start"}))},[d]),{option:{...r,active:d,disabled:l,index:e,selected:f},optionProps:{"aria-disabled":l,"aria-posinset":e+1,"aria-selected":l?void 0:f,"aria-setsize":a.state.options.length,id:H(t,r),onClick:v,onMouseDown:m,ref:c,role:"option",tabIndex:-1}}}function Ve({inputRef:e,manager:t}){return s.useRef({input:{clear(){t.clearValue()},focus(){var a;(a=e.current)==null||a.focus()},get value(){return t.state.value},set value(a){t.updateValue(a)}},listBox:{collapse(){t.collapse()},expand(){t.expand()},get activeIndex(){return t.state.activeIndex},set activeIndex(a){t.updateActiveIndex(a)},get isExpanded(){return t.state.isExpanded},get options(){return t.state.options}}}).current}function Le(){const[e,t]=s.useState(!1),{id:n,inputRef:a,rootRef:o}=s.useContext(p),c=s.useMemo(()=>({"aria-describedby":w(n),id:n,onFocus(){t(!0)},onBlur(){var r;(r=o.current)!=null&&r.contains(document.activeElement)||t(!1)},onClick(){var r;document.activeElement===o.current&&((r=a.current)==null||r.focus())},ref:o,tabIndex:-1}),[a,n,o]);return{isActive:e,rootProps:c}}function Ke(e,t){const{isDisabled:n,manager:a,onSelect:o}=s.useContext(p),c=a.state.selected[e],r=s.useCallback(()=>o(c),[o,c]);return{tag:c,tagProps:{"aria-disabled":n,title:h(t,c.label),onClick:n?K:r}}}const $e={position:"absolute",width:1,height:1,left:-9999,overflow:"hidden",clip:"rect(0 0 0 0)"};function Fe({ariaAddedText:e,ariaDeletedText:t}){const{manager:n}=s.useContext(p),a=s.useRef([]);return n.flags.tagsAdded.forEach(o=>{a.current.push(h(e,o.label))}),n.flags.tagsDeleted.forEach(o=>{a.current.push(h(t,o.label))}),i.default.createElement("div",{"aria-live":"polite","aria-relevant":"additions",role:"status",style:$e},a.current.join(`
`))}function ze({children:e}){const{classNames:t}=s.useContext(p),n=Ee();return i.default.createElement("div",{className:t.comboBox,...n},e)}function je({allowBackspace:e=!0,allowResize:t=!0,allowTab:n=!1,ariaDescribedBy:a,ariaErrorMessage:o,placeholderText:c}){const{classNames:r}=s.useContext(p),{value:d,...l}=Ce({allowBackspace:e,allowTab:n,ariaDescribedBy:a,ariaErrorMessage:o}),f=d.length<c.length?c:d,{sizerProps:v,width:m}=Re({allowResize:t,text:f});return i.default.createElement(i.default.Fragment,null,i.default.createElement("input",{className:r.input,placeholder:c,style:{width:m},value:d,...l}),t?i.default.createElement("div",{...v},f):null)}const We=({children:e,classNames:t,id:n})=>i.default.createElement("div",{className:t.label,id:n},e);function qe({children:e,render:t=We}){const{classNames:n,id:a}=s.useContext(p);return t({children:e,classNames:n,id:w(a)})}function He({children:e}){const{classNames:t,manager:n}=s.useContext(p),a=Te();return!n.state.isExpanded||i.default.Children.count(e)===0?null:i.default.createElement("div",{className:t.listBox,...a},e)}function Ge({label:e,query:t}){return i.default.createElement("span",null,h(e,t))}const Je=i.default.memo(Ge),Qe=({children:e,classNames:t,option:n,...a})=>{const o=[t.option];return n.active&&o.push(t.optionIsActive),i.default.createElement("div",{className:o.join(" "),...a},e)};function Xe({index:e,render:t=Qe}){const{classNames:n,manager:a}=s.useContext(p),{option:o,optionProps:c}=Ue(e),r=o.value===$||o.value===Q?i.default.createElement(Je,{label:o.label,query:a.state.value}):i.default.createElement(Me,{label:o.label,query:a.state.value});return t({classNames:n,children:r,option:o,...c})}function Ye(e,t){const n=J(t);return e.replace(n,"<mark>$&</mark>")}function Ze({label:e,query:t}){return i.default.createElement("span",{dangerouslySetInnerHTML:{__html:Ye(e,t)}})}const Me=i.default.memo(Ze);function et({children:e}){De();const{classNames:t,isDisabled:n,isInvalid:a}=s.useContext(p),{isActive:o,rootProps:c}=Le(),r=[t.root];return o&&r.push(t.rootIsActive),n&&r.push(t.rootIsDisabled),a&&r.push(t.rootIsInvalid),i.default.createElement("div",{className:r.join(" "),...c},e)}const tt=({classNames:e,tag:t,...n})=>i.default.createElement("button",{type:"button",className:e.tag,...n},i.default.createElement("span",{className:e.tagName},t.label));function nt({render:e=tt,index:t,title:n}){const{classNames:a}=s.useContext(p),{tag:o,tagProps:c}=Ke(t,n);return e({classNames:a,tag:o,...c})}function at({children:e,label:t}){const{classNames:n,tagListRef:a}=s.useContext(p);return i.default.createElement("ul",{className:n.tagList,"aria-label":t,ref:a,role:"list"},e.map(o=>i.default.createElement("li",{className:n.tagListItem,key:o.key,role:"listitem"},o)))}const ot={root:"react-tags",rootIsActive:"is-active",rootIsDisabled:"is-disabled",rootIsInvalid:"is-invalid",label:"react-tags__label",tagList:"react-tags__list",tagListItem:"react-tags__list-item",tag:"react-tags__tag",tagName:"react-tags__tag-name",comboBox:"react-tags__combobox",input:"react-tags__combobox-input",listBox:"react-tags__listbox",noOptions:"react-tags__listbox-no-options",option:"react-tags__listbox-option",optionIsActive:"is-active"};function st({allowBackspace:e=!0,allowNew:t=!1,allowResize:n=!0,allowTab:a=!1,ariaAddedText:o="Added tag %value%",ariaDescribedBy:c,ariaErrorMessage:r,ariaDeletedText:d="Removed tag %value%",classNames:l=ot,closeOnSelect:f=!1,deleteButtonText:v="Remove %value% from the list",id:m="react-tags",isDisabled:y=!1,isInvalid:x=!1,labelText:R="Select tags",newOptionText:D="Add %value%",noOptionsText:S="No options found for %value%",onAdd:T,onDelete:O,onInput:A,onValidate:P,placeholderText:k="Add a tag",renderLabel:N,renderOption:_,renderTag:F,selected:u=[],suggestions:E=[],suggestionsTransform:X=be,tagListLabelText:Y="Selected tags"},B){var j;const Z=s.useRef(null),z=s.useRef(null),M=s.useRef(null),ee=s.useRef(null),te=s.useRef(null),{newTagOption:ne,noTagsOption:ae}=Se({newOptionText:D,noOptionsText:S,onValidate:P}),I=ke({activeIndex:-1,activeOption:null,allowNew:t,isExpanded:!1,newTagOption:ne,noTagsOption:ae,options:[],selected:u,suggestions:E,suggestionsTransform:X,value:""}),oe=Be({closeOnSelect:f,manager:I,onAdd:T,onDelete:O}),se=Ve({inputRef:z,manager:I});return B&&((j=B.current)!=null||(B.current=se)),i.default.createElement(p.Provider,{value:{classNames:l,comboBoxRef:Z,id:m,inputRef:z,isDisabled:y,isInvalid:x,listBoxRef:M,manager:I,onInput:A,onSelect:oe,rootRef:ee,tagListRef:te}},i.default.createElement(et,null,i.default.createElement(qe,{render:N},R),i.default.createElement(at,{label:Y},I.state.selected.map((U,V)=>i.default.createElement(nt,{key:L(U),index:V,render:F,title:v}))),i.default.createElement(ze,null,i.default.createElement(je,{allowBackspace:e,allowResize:n,allowTab:a,placeholderText:k,ariaDescribedBy:c,ariaErrorMessage:r}),i.default.createElement(He,null,I.state.options.map((U,V)=>i.default.createElement(Xe,{key:L(U),index:V,render:_})))),i.default.createElement(Fe,{ariaAddedText:o,ariaDeletedText:d})))}const lt=i.default.forwardRef(st);exports.ReactTags=lt;
