(function(b,a){typeof exports=="object"&&typeof module<"u"?a(exports,require("react")):typeof define=="function"&&define.amd?define(["exports","react"],a):(b=typeof globalThis<"u"?globalThis:b||self,a(b.ReactTags={},b.React))})(this,function(b,a){"use strict";const i=(e=>e&&typeof e=="object"&&"default"in e?e:{default:e})(a);function Y(e){return e.selectionStart===0&&e.selectionEnd===0}function Z(e){const t=e.value.length;return e.selectionStart===t&&e.selectionEnd===t}function ut(e){return e}function w(e){return`${e}-label`}function M(e){return`${e}-combobox`}function ee(e){return`${e}-input`}function j(e){return`${e}-listbox`}function R(e,t){return`${e}-option-${oe(t)}`}const te=/%value%/;function T(e,t){return e.replace(te,t)}const ne=/\s+/g;function D(e){return`${String(e.value)}-${e.label}`}function oe(e){return D(e).replace(ne,"_")}function h(e,t){return t.findIndex(({value:n})=>n===e.value)}const se=/[-\\^$*+?.()|[\]{}]/g;function W(e){return e.replace(se,"\\$&")}function q(e){return new RegExp(`${W(e)}`,"i")}function ae(e){return new RegExp(`^${W(e)}$`,"i")}function le(e){const t=q(e);return n=>t.test(n)}function re(e){const t=ae(e);return n=>t.test(n)}function ue(e,t){if(e==="")return[].concat(t);{const n=le(e);return t.filter(o=>n(o.label))}}function ie(e,t){const n=re(e);return t.find(o=>n(o.label))||null}const p=i.default.createContext(void 0);function ce(){const{comboBoxRef:e,id:t,manager:n}=a.useContext(p);return a.useMemo(()=>({id:M(t),ref:e,onBlur(o){var s;(s=e.current)!=null&&s.contains(o.relatedTarget)||(n.collapse(),n.clearActiveIndex())},onFocus(o){var s;(s=e.current)!=null&&s.contains(o.relatedTarget)||n.expand()},onClick(){n.state.isExpanded||n.expand()}}),[e,t,n])}const m={Enter:"Enter",Escape:"Escape",Tab:"Tab",Backspace:"Backspace",UpArrow:"ArrowUp",UpArrowCompat:"Up",DownArrow:"ArrowDown",DownArrowCompat:"Down",PageDown:"PageDown",PageUp:"PageUp"},S=Symbol("Create new tag"),H=Symbol("No options"),O=()=>{},de={autoComplete:"off",autoCorrect:"off","data-form-type":"other",spellCheck:!1};function pe({allowBackspace:e,allowTab:t,ariaDescribedBy:n,ariaErrorMessage:o}){const{id:s,inputRef:c,isDisabled:r,isInvalid:d,manager:l,onInput:f,onSelect:g}=a.useContext(p),y=a.useMemo(()=>{const P=u=>{const I=u.currentTarget.value;l.updateValue(I),f==null||f(I)},k=u=>{l.state.isExpanded?(u.preventDefault(),l.updateActiveIndex(l.state.activeIndex+1)):Z(u.currentTarget)&&l.expand()},_=u=>{l.state.isExpanded?(u.preventDefault(),l.updateActiveIndex(l.state.activeIndex-1)):Y(u.currentTarget)&&l.expand()},N=u=>{l.state.isExpanded&&(u.preventDefault(),l.updateActiveIndex(l.state.options.length-1))},B=u=>{l.state.isExpanded&&(u.preventDefault(),l.updateActiveIndex(0))},U=u=>{l.state.isExpanded&&(u.preventDefault(),g())},L=()=>{l.state.isExpanded?(l.clearActiveIndex(),l.collapse()):l.clearValue()},V=()=>{if(e){const u=l.state.value==="",I=l.state.selected[l.state.selected.length-1];u&&I&&g(I)}},K=u=>{t&&l.state.isExpanded&&(u.preventDefault(),g())};return{onChange:P,onKeyDown:u=>{if(u.key===m.UpArrow)return _(u);if(u.key===m.DownArrow)return k(u);if(u.key===m.PageUp)return B(u);if(u.key===m.PageDown)return N(u);if(u.key===m.Enter)return U(u);if(u.key===m.Escape)return L();if(u.key===m.Backspace)return V();if(u.key===m.Tab)return K(u)}}},[e,t,l,f,g]),{activeOption:E,isExpanded:x,value:A}=l.state;return{...de,"aria-autocomplete":"list","aria-activedescendant":E?R(s,E):void 0,"aria-describedby":n||void 0,"aria-disabled":r,"aria-errormessage":d&&o||void 0,"aria-invalid":d,"aria-labelledby":w(s),"aria-expanded":x,"aria-owns":j(s),id:ee(s),onChange:r?O:y.onChange,onKeyDown:r?O:y.onKeyDown,ref:c,role:"combobox",type:"text",value:A}}const fe={position:"absolute",width:0,height:0,visibility:"hidden",overflow:"scroll",whiteSpace:"pre"},ve=["font-family","font-size","font-style","font-weight","letter-spacing","text-transform"];function ge({allowResize:e=!0,text:t}){const n=a.useRef(null),{inputRef:o}=a.useContext(p),[s,c]=a.useState(0);return a.useEffect(()=>{if(o.current){const r=window.getComputedStyle(o.current);ve.forEach(d=>{var f;const l=r.getPropertyValue(d);(f=n.current)==null||f.style.setProperty(d,l)})}},[o,n]),a.useEffect(()=>{var r,d;if(e){const l=Math.ceil((d=(r=n.current)==null?void 0:r.scrollWidth)!=null?d:0)+2;s!==l&&c(l)}},[e,t,s]),{width:s,sizerProps:{ref:n,style:fe}}}function xe(){var c;const{inputRef:e,manager:t,tagListRef:n}=a.useContext(p),o=t.flags.tagsDeleted.length,s=(c=n.current)==null?void 0:c.contains(document.activeElement);a.useEffect(()=>{var r,d;if(o){const l=(r=n.current)==null?void 0:r.contains(document.activeElement);s&&!l&&((d=e.current)==null||d.focus())}},[e,s,n,o])}function me({newOptionText:e,noOptionsText:t,onValidate:n}){return a.useMemo(()=>({newTagOption(o){return{disabled:typeof n=="function"?!n(o):!1,label:e,value:S}},noTagsOption(){return{disabled:!0,label:t,value:H}}}),[e,t,n])}function ye(){const{id:e,listBoxRef:t,manager:n}=a.useContext(p);return a.useEffect(()=>{var o;n.state.activeIndex===-1&&((o=t.current)==null||o.scrollTo({top:0}))},[t,n.state.activeIndex]),{"aria-labelledby":w(e),id:j(e),ref:t,role:"listbox"}}var v=(e=>(e[e.ClearActiveIndex=0]="ClearActiveIndex",e[e.ClearAll=1]="ClearAll",e[e.ClearValue=2]="ClearValue",e[e.Collapse=3]="Collapse",e[e.Expand=4]="Expand",e[e.UpdateActiveIndex=5]="UpdateActiveIndex",e[e.UpdateSelected=6]="UpdateSelected",e[e.UpdateSuggestions=7]="UpdateSuggestions",e[e.UpdateValue=8]="UpdateValue",e))(v||{});function be(e,t){const n=t-1;return e>n?-1:e<-1?n:e}function Ee(e,t){if(t.type===0)return{...e,activeIndex:-1,activeOption:null};if(t.type===1)return{...e,activeIndex:-1,activeOption:null,isExpanded:!1,options:[...e.suggestions],value:""};if(t.type===2){const n=[...e.suggestions],o=e.activeOption?h(e.activeOption,n):-1;return{...e,activeIndex:o,activeOption:n[o],options:n,value:""}}if(t.type===3)return{...e,activeIndex:-1,activeOption:null,isExpanded:!1};if(t.type===4)return{...e,isExpanded:!0};if(t.type===5){const n=be(t.payload,e.options.length);return{...e,activeIndex:n,activeOption:e.options[n]}}if(t.type===6)return{...e,selected:t.payload};if(t.type===7){const n=e.suggestionsTransform(e.value,t.payload);e.allowNew&&e.value&&n.push(e.newTagOption(e.value)),n.length===0&&e.value&&n.push(e.noTagsOption(e.value));const o=e.activeOption?h(e.activeOption,n):-1;return{...e,activeIndex:o,activeOption:n[o]||null,options:n,suggestions:t.payload}}if(t.type===8){const n=e.suggestionsTransform(t.payload,e.suggestions);e.allowNew&&t.payload&&n.push(e.newTagOption(t.payload)),n.length===0&&t.payload&&n.push(e.noTagsOption(t.payload));const o=e.activeOption?h(e.activeOption,n):-1;return{...e,activeIndex:o,activeOption:n[o]||null,isExpanded:!0,options:n,value:t.payload}}return e}function G(e,t){return e===t?[]:e.filter(n=>!t.includes(n))}function Ie(e){const t=e.suggestionsTransform(e.value,e.suggestions);return{...e,options:t}}function he(e){const[t,n]=a.useReducer(Ee,e,Ie),o=a.useRef({state:null,flags:null,clearActiveIndex(){n({type:v.ClearActiveIndex})},clearAll(){n({type:v.ClearAll})},clearValue(){n({type:v.ClearValue})},collapse(){n({type:v.Collapse})},expand(){n({type:v.Expand})},updateActiveIndex(s){n({type:v.UpdateActiveIndex,payload:s})},updateSelected(s){n({type:v.UpdateSelected,payload:s})},updateSuggestions(s){n({type:v.UpdateSuggestions,payload:s})},updateValue(s){n({type:v.UpdateValue,payload:s})}});return o.current.flags={tagsAdded:o.current.state?G(t.selected,o.current.state.selected):[],tagsDeleted:o.current.state?G(o.current.state.selected,t.selected):[]},o.current.state=t,e.selected!==t.selected&&o.current.updateSelected(e.selected),e.suggestions!==t.suggestions&&o.current.updateSuggestions(e.suggestions),o.current}function Ce(e,t){if((e==null?void 0:e.value)===S&&e.disabled===!1)return{value:t,label:t}}function we(e){const t=Ce(e.activeOption,e.value)||e.activeOption||ie(e.value,e.options);return t&&!t.disabled?t:void 0}function Te({closeOnSelect:e,manager:t,onAdd:n,onDelete:o}){return a.useCallback(s=>{if(s!=null||(s=we(t.state)),!s)return;const c=h(s,t.state.selected);c>=0?o(c):(n(s),e?t.clearAll():t.clearValue())},[e,t,o,n])}function De(e){var E;const{id:t,inputRef:n,manager:o,onSelect:s}=a.useContext(p),c=a.useRef(null),r=o.state.options[e],d=e===o.state.activeIndex,l=(E=r.disabled)!=null?E:!1,f=h(r,o.state.selected)>-1,g=a.useCallback(()=>{var x;s(),(x=n.current)==null||x.focus()},[n,s]),y=a.useCallback(()=>{e!==o.state.activeIndex&&o.updateActiveIndex(e)},[e,o]);return a.useEffect(()=>{var x;d&&((x=c.current)==null||x.scrollIntoView({block:"nearest",inline:"start"}))},[d]),{option:{...r,active:d,disabled:l,index:e,selected:f},optionProps:{"aria-disabled":l,"aria-posinset":e+1,"aria-selected":l?void 0:f,"aria-setsize":o.state.options.length,id:R(t,r),onClick:g,onMouseDown:y,ref:c,role:"option",tabIndex:-1}}}function Se({inputRef:e,manager:t}){return a.useRef({input:{clear(){t.clearValue()},focus(){var o;(o=e.current)==null||o.focus()},get value(){return t.state.value},set value(o){t.updateValue(o)}},listBox:{collapse(){t.collapse()},expand(){t.expand()},get activeIndex(){return t.state.activeIndex},set activeIndex(o){t.updateActiveIndex(o)},get isExpanded(){return t.state.isExpanded},get options(){return t.state.options}}}).current}function Oe(){const[e,t]=a.useState(!1),{id:n,inputRef:o,rootRef:s}=a.useContext(p),c=a.useMemo(()=>({"aria-describedby":w(n),id:n,onFocus(){t(!0)},onBlur(){var r;(r=s.current)!=null&&r.contains(document.activeElement)||t(!1)},onClick(){var r;document.activeElement===s.current&&((r=o.current)==null||r.focus())},ref:s,tabIndex:-1}),[o,n,s]);return{isActive:e,rootProps:c}}function Ae(e,t){const{isDisabled:n,manager:o,onSelect:s}=a.useContext(p),c=o.state.selected[e],r=a.useCallback(()=>s(c),[s,c]);return{tag:c,tagProps:{"aria-disabled":n,title:T(t,c.label),onClick:n?O:r}}}const Pe={position:"absolute",width:1,height:1,left:-9999,overflow:"hidden",clip:"rect(0 0 0 0)"};function ke({ariaAddedText:e,ariaDeletedText:t}){const{manager:n}=a.useContext(p),o=a.useRef([]);return n.flags.tagsAdded.forEach(s=>{o.current.push(T(e,s.label))}),n.flags.tagsDeleted.forEach(s=>{o.current.push(T(t,s.label))}),i.default.createElement("div",{"aria-live":"polite","aria-relevant":"additions",role:"status",style:Pe},o.current.join(`
`))}function _e({children:e}){const{classNames:t}=a.useContext(p),n=ce();return i.default.createElement("div",{className:t.comboBox,...n},e)}function Ne({allowBackspace:e=!0,allowResize:t=!0,allowTab:n=!1,ariaDescribedBy:o,ariaErrorMessage:s,placeholderText:c}){const{classNames:r}=a.useContext(p),{value:d,...l}=pe({allowBackspace:e,allowTab:n,ariaDescribedBy:o,ariaErrorMessage:s}),f=d.length<c.length?c:d,{sizerProps:g,width:y}=ge({allowResize:t,text:f});return i.default.createElement(i.default.Fragment,null,i.default.createElement("input",{className:r.input,placeholder:c,style:{width:y},value:d,...l}),t?i.default.createElement("div",{...g},f):null)}const Be=({children:e,classNames:t,id:n})=>i.default.createElement("div",{className:t.label,id:n},e);function Ue({children:e,render:t=Be}){const{classNames:n,id:o}=a.useContext(p);return t({children:e,classNames:n,id:w(o)})}function Le({children:e}){const{classNames:t,manager:n}=a.useContext(p),o=ye();return!n.state.isExpanded||i.default.Children.count(e)===0?null:i.default.createElement("div",{className:t.listBox,...o},e)}function Ve({label:e,query:t}){return i.default.createElement("span",null,T(e,t))}const Ke=i.default.memo(Ve),$e=({children:e,classNames:t,option:n,...o})=>{const s=[t.option];return n.active&&s.push(t.optionIsActive),i.default.createElement("div",{className:s.join(" "),...o},e)};function Fe({index:e,render:t=$e}){const{classNames:n,manager:o}=a.useContext(p),{option:s,optionProps:c}=De(e),r=s.value===S||s.value===H?i.default.createElement(Ke,{label:s.label,query:o.state.value}):i.default.createElement(Re,{label:s.label,query:o.state.value});return t({classNames:n,children:r,option:s,...c})}function ze(e,t){const n=q(t);return e.replace(n,"<mark>$&</mark>")}function je({label:e,query:t}){return i.default.createElement("span",{dangerouslySetInnerHTML:{__html:ze(e,t)}})}const Re=i.default.memo(je);function We({children:e}){xe();const{classNames:t,isDisabled:n,isInvalid:o}=a.useContext(p),{isActive:s,rootProps:c}=Oe(),r=[t.root];return s&&r.push(t.rootIsActive),n&&r.push(t.rootIsDisabled),o&&r.push(t.rootIsInvalid),i.default.createElement("div",{className:r.join(" "),...c},e)}const qe=({classNames:e,tag:t,...n})=>i.default.createElement("button",{type:"button",className:e.tag,...n},i.default.createElement("span",{className:e.tagName},t.label));function He({render:e=qe,index:t,title:n}){const{classNames:o}=a.useContext(p),{tag:s,tagProps:c}=Ae(t,n);return e({classNames:o,tag:s,...c})}function Ge({children:e,label:t}){const{classNames:n,tagListRef:o}=a.useContext(p);return i.default.createElement("ul",{className:n.tagList,"aria-label":t,ref:o,role:"list"},e.map(s=>i.default.createElement("li",{className:n.tagListItem,key:s.key,role:"listitem"},s)))}const Je={root:"react-tags",rootIsActive:"is-active",rootIsDisabled:"is-disabled",rootIsInvalid:"is-invalid",label:"react-tags__label",tagList:"react-tags__list",tagListItem:"react-tags__list-item",tag:"react-tags__tag",tagName:"react-tags__tag-name",comboBox:"react-tags__combobox",input:"react-tags__combobox-input",listBox:"react-tags__listbox",noOptions:"react-tags__listbox-no-options",option:"react-tags__listbox-option",optionIsActive:"is-active"};function Qe({allowBackspace:e=!0,allowNew:t=!1,allowResize:n=!0,allowTab:o=!1,ariaAddedText:s="Added tag %value%",ariaDescribedBy:c,ariaErrorMessage:r,ariaDeletedText:d="Removed tag %value%",classNames:l=Je,closeOnSelect:f=!1,deleteButtonText:g="Remove %value% from the list",id:y="react-tags",isDisabled:E=!1,isInvalid:x=!1,labelText:A="Select tags",newOptionText:P="Add %value%",noOptionsText:k="No options found for %value%",onAdd:_,onDelete:N,onInput:B,onValidate:U,placeholderText:L="Add a tag",renderLabel:V,renderOption:K,renderTag:J,selected:u=[],suggestions:I=[],suggestionsTransform:Ye=ue,tagListLabelText:Ze="Selected tags"},$){var X;const Me=a.useRef(null),Q=a.useRef(null),et=a.useRef(null),tt=a.useRef(null),nt=a.useRef(null),{newTagOption:ot,noTagsOption:st}=me({newOptionText:P,noOptionsText:k,onValidate:U}),C=he({activeIndex:-1,activeOption:null,allowNew:t,isExpanded:!1,newTagOption:ot,noTagsOption:st,options:[],selected:u,suggestions:I,suggestionsTransform:Ye,value:""}),at=Te({closeOnSelect:f,manager:C,onAdd:_,onDelete:N}),lt=Se({inputRef:Q,manager:C});return $&&((X=$.current)!=null||($.current=lt)),i.default.createElement(p.Provider,{value:{classNames:l,comboBoxRef:Me,id:y,inputRef:Q,isDisabled:E,isInvalid:x,listBoxRef:et,manager:C,onInput:B,onSelect:at,rootRef:tt,tagListRef:nt}},i.default.createElement(We,null,i.default.createElement(Ue,{render:V},A),i.default.createElement(Ge,{label:Ze},C.state.selected.map((F,z)=>i.default.createElement(He,{key:D(F),index:z,render:J,title:g}))),i.default.createElement(_e,null,i.default.createElement(Ne,{allowBackspace:e,allowResize:n,allowTab:o,placeholderText:L,ariaDescribedBy:c,ariaErrorMessage:r}),i.default.createElement(Le,null,C.state.options.map((F,z)=>i.default.createElement(Fe,{key:D(F),index:z,render:K})))),i.default.createElement(ke,{ariaAddedText:s,ariaDeletedText:d})))}const Xe=i.default.forwardRef(Qe);b.ReactTags=Xe,Object.defineProperties(b,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
